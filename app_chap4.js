//Deploy Contract with web3.js
var Tx = require('ethereumjs-tx')
var Web3 = require('web3')

var web3 = Web3('https://ropsten.infura.io/v3/a55fba2fccc0495b97c84c0fed5889b0')

var account1 = '0x06CEAc90b1B1ff32b5e709E29F31443daB03aA8C'

const privateKey1= Buffer.from(process.env.PRIVATE_KEY1,'hex');//convert private key to string of binary data

//Create TXn Object
web3.eth.getTransactionCount(account1).then(_nonce => {
    //Smart Contract Data
    const data = '0x608060405234801561001057600080fd5b50600080819055506110f3806100276000396000f3fe608060405260043610610072576000357c0100000000000000000000000000000000000000000000000000000000900480631d65e77e14610077578063292a4585146101b75780638d97767214610316578063bcd1480514610456578063d81ef739146104c2578063f885f0d9146104fd575b600080fd5b34801561008357600080fd5b506100b06004803603602081101561009a57600080fd5b8101908080359060200190929190505050610636565b60405180878152602001868152602001806020018060200185151515158152602001848152602001838103835287818151815260200191508051906020019080838360005b838110156101105780820151818401526020810190506100f5565b50505050905090810190601f16801561013d5780820380516001836020036101000a031916815260200191505b50838103825286818151815260200191508051906020019080838360005b8381101561017657808201518184015260208101905061015b565b50505050905090810190601f1680156101a35780820380516001836020036101000a031916815260200191505b509850505050505050505060405180910390f35b3480156101c357600080fd5b50610314600480360360408110156101da57600080fd5b81019080803590602001906401000000008111156101f757600080fd5b82018360208201111561020957600080fd5b8035906020019184600183028401116401000000008311171561022b57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192908035906020019064010000000081111561028e57600080fd5b8201836020820111156102a057600080fd5b803590602001918460018302840111640100000000831117156102c257600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050919291929050505061089c565b005b34801561032257600080fd5b5061034f6004803603602081101561033957600080fd5b8101908080359060200190929190505050610aca565b60405180878152602001868152602001806020018060200185151515158152602001848152602001838103835287818151815260200191508051906020019080838360005b838110156103af578082015181840152602081019050610394565b50505050905090810190601f1680156103dc5780820380516001836020036101000a031916815260200191505b50838103825286818151815260200191508051906020019080838360005b838110156104155780820151818401526020810190506103fa565b50505050905090810190601f1680156104425780820380516001836020036101000a031916815260200191505b509850505050505050505060405180910390f35b34801561046257600080fd5b5061046b610c43565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156104ae578082015181840152602081019050610493565b505050509050019250505060405180910390f35b3480156104ce57600080fd5b506104fb600480360360208110156104e557600080fd5b8101908080359060200190929190505050610c9b565b005b34801561050957600080fd5b506105366004803603602081101561052057600080fd5b8101908080359060200190929190505050610f59565b60405180868152602001858152602001806020018060200184151515158152602001838103835286818151815260200191508051906020019080838360005b83811015610590578082015181840152602081019050610575565b50505050905090810190601f1680156105bd5780820380516001836020036101000a031916815260200191505b50838103825285818151815260200191508051906020019080838360005b838110156105f65780820151818401526020810190506105db565b50505050905090810190601f1680156106235780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b6000806060806000808660006002600083815260200190815260200160002060000154141515156106cf576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600c8152602001807f496e76616c6964205461736b000000000000000000000000000000000000000081525060200191505060405180910390fd5b87600260008a815260200190815260200160002060010154600260008b8152602001908152602001600020600201600260008c8152602001908152602001600020600301600260008d815260200190815260200160002060040160009054906101000a900460ff16600260008e815260200190815260200160002060050154838054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107e35780601f106107b8576101008083540402835291602001916107e3565b820191906000526020600020905b8154815290600101906020018083116107c657829003601f168201915b50505050509350828054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561087f5780601f106108545761010080835404028352916020019161087f565b820191906000526020600020905b81548152906001019060200180831161086257829003601f168201915b505050505092509650965096509650965096505091939550919395565b600080815480929190600101919050555060c06040519081016040528060005481526020014281526020018381526020018281526020016000151581526020016000815250600260008054815260200190815260200160002060008201518160000155602082015181600101556040820151816002019080519060200190610925929190610fe9565b506060820151816003019080519060200190610942929190610fe9565b5060808201518160040160006101000a81548160ff02191690831515021790555060a08201518160050155905050600160005490806001815401808255809150509060018203906000526020600020016000909192909190915055507f1e3881e13dd1f9f4074a664cb5ec01ae831747a49d340ed5a3208b8b5562583b600054428484600060405180868152602001858152602001806020018060200184151515158152602001838103835286818151815260200191508051906020019080838360005b83811015610a21578082015181840152602081019050610a06565b50505050905090810190601f168015610a4e5780820380516001836020036101000a031916815260200191505b50838103825285818151815260200191508051906020019080838360005b83811015610a87578082015181840152602081019050610a6c565b50505050905090810190601f168015610ab45780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390a15050565b6002602052806000526040600020600091509050806000015490806001015490806002018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b825780601f10610b5757610100808354040283529160200191610b82565b820191906000526020600020905b815481529060010190602001808311610b6557829003601f168201915b505050505090806003018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c205780601f10610bf557610100808354040283529160200191610c20565b820191906000526020600020905b815481529060010190602001808311610c0357829003601f168201915b5050505050908060040160009054906101000a900460ff16908060050154905086565b60606001805480602002602001604051908101604052809291908181526020018280548015610c9157602002820191906000526020600020905b815481526020019060010190808311610c7d575b5050505050905090565b806000600260008381526020019081526020016000206000015414151515610d2b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600c8152602001807f496e76616c6964205461736b000000000000000000000000000000000000000081525060200191505060405180910390fd5b610d33611069565b6002600084815260200190815260200160002060c060405190810160405290816000820154815260200160018201548152602001600282018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610dff5780601f10610dd457610100808354040283529160200191610dff565b820191906000526020600020905b815481529060010190602001808311610de257829003601f168201915b50505050508152602001600382018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610ea15780601f10610e7657610100808354040283529160200191610ea1565b820191906000526020600020905b815481529060010190602001808311610e8457829003601f168201915b505050505081526020016004820160009054906101000a900460ff1615151515815260200160058201548152505090508060800151158160800190151590811515815250508060800151610ef6576000610ef8565b425b8160a00181815250507fcb1ceae718a6ae11d5daf00e292e318717e0acf2d326ed670df0e5ff67ba50008382608001518360a001516040518084815260200183151515158152602001828152602001935050505060405180910390a1505050565b6000806060806000804260008292506040805190810160405280600c81526020017f4920616d20776f726b696e670000000000000000000000000000000000000000815250906040805190810160405280600581526020017f4d65646861000000000000000000000000000000000000000000000000000000815250909450945094509450945091939590929450565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061102a57805160ff1916838001178555611058565b82800160010185558215611058579182015b8281111561105757825182559160200191906001019061103c565b5b50905061106591906110a2565b5090565b60c06040519081016040528060008152602001600081526020016060815260200160608152602001600015158152602001600081525090565b6110c491905b808211156110c05760008160009055506001016110a8565b5090565b9056fea165627a7a7230582078644057a793f0cc6a5f735a067d3aeb0e91248ed835efc60e0dcef0f6104d8d0029' //feed bytecode in hex

    //Build the transaction
    const txObject = {
        nonce:'0x'+_nonce.toString(16),
        gasPrice:100000,
        gasLimit:1000000,//Raise this 
        data:data // bytecode of SC no "to" as we are broadcastinng the txn to entire network with data// data is the code of SC
    }

    //Sign The Txn
    const tx = new Tx(txObject);
    tx.sign(privateKey1)//sign raw Txn

    //Broadcast the Txn

    var call = async function (){
        try {
        // Broadcast the transaction
        await web3.eth.sendSignedTransaction(raw,(err,txHash)=>{//send signed raw TXn
        console.log("txHash",txHash);
        })}catch(err) {
        console.log(err)
        }
    }//expectes a signed transaction
    call();
    web3.eth.getBalance(account1,(err,bal)=>{
        console.log("Account1 balance",web3.utils.fromWei(bal,'ether'))
    })
})
   

